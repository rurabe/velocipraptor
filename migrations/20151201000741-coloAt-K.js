'use strict';

var dbm = global.dbm || require('db-migrate');
var type = dbm.dataType;

var DATA = [
  ['1',     '185.59.76.35,255.255.252.0'],
  ['1',     '185.59.79.31,255.255.252.0'],
  ['1',     '185.59.76.22,255.255.252.0'],
  ['1',     '185.59.78.44,255.255.252.0'],
  ['2',     '185.59.77.6,255.255.252.0'],
  ['2',     '185.59.78.35,255.255.252.0'],
  ['2',     '185.59.76.18,255.255.252.0'],
  ['2',     '185.59.79.36,255.255.252.0'],
  ['3',     '185.59.79.38,255.255.252.0'],
  ['3',     '185.59.78.25,255.255.252.0'],
  ['3',     '185.59.76.42,255.255.252.0'],
  ['3',     '185.59.76.30,255.255.252.0'],
  ['4',     '185.59.76.32,255.255.252.0'],
  ['4',     '185.59.76.44,255.255.252.0'],
  ['4',     '185.59.77.16,255.255.252.0'],
  ['4',     '185.59.79.4,255.255.252.0'],
  ['5',     '185.59.79.21,255.255.252.0'],
  ['5',     '185.59.76.8,255.255.252.0'],
  ['5',     '185.59.79.33,255.255.252.0'],
  ['5',     '185.59.78.47,255.255.252.0'],
  ['6',     '185.59.76.37,255.255.252.0'],
  ['6',     '185.59.77.43,255.255.252.0'],
  ['6',     '185.59.78.37,255.255.252.0'],
  ['6',     '185.59.78.18,255.255.252.0'],
  ['7',     '185.59.78.39,255.255.252.0'],
  ['7',     '185.59.77.28,255.255.252.0'],
  ['7',     '185.59.79.28,255.255.252.0'],
  ['7',     '185.59.77.23,255.255.252.0'],
  ['8',     '185.59.79.14,255.255.252.0'],
  ['8',     '185.59.79.43,255.255.252.0'],
  ['8',     '185.59.78.42,255.255.252.0'],
  ['8',     '185.59.77.26,255.255.252.0'],
  ['9',     '185.59.79.45,255.255.252.0'],
  ['9',     '185.59.76.20,255.255.252.0'],
  ['9',     '185.59.76.5,255.255.252.0'],
  ['9',     '185.59.79.26,255.255.252.0'],
  ['10',    '185.59.78.13,255.255.252.0'],
  ['10',    '185.59.78.5,255.255.252.0'],
  ['10',    '185.59.76.27,255.255.252.0'],
  ['10',    '185.59.78.30,255.255.252.0'],
  ['11',    '185.59.78.20,255.255.252.0'],
  ['11',    '185.59.79.11,255.255.252.0'],
  ['11',    '185.59.76.13,255.255.252.0'],
  ['11',    '185.59.77.11,255.255.252.0'],
  ['12',    '185.59.78.3,255.255.252.0'],
  ['12',    '185.59.76.39,255.255.252.0'],
  ['12',    '185.59.79.19,255.255.252.0'],
  ['12',    '185.59.78.22,255.255.252.0'],
  ['13',    '185.59.76.15,255.255.252.0'],
  ['13',    '185.59.79.16,255.255.252.0'],
  ['13',    '185.59.79.40,255.255.252.0'],
  ['13',    '185.59.76.10,255.255.252.0'],
  ['14',    '185.59.79.9,255.255.252.0'],
  ['14',    '185.59.77.40,255.255.252.0'],
  ['14',    '185.59.78.32,255.255.252.0'],
  ['14',    '185.59.79.48,255.255.252.0'],
  ['15',    '185.59.77.36,255.255.252.0'],
  ['15',    '185.59.78.8,255.255.252.0'],
  ['15',    '185.59.77.4,255.255.252.0'],
  ['15',    '185.59.77.48,255.255.252.0'],
  ['16',    '185.59.77.31,255.255.252.0'],
  ['16',    '185.59.76.25,255.255.252.0'],
  ['16',    '185.59.76.3,255.255.252.0'],
  ['16',    '185.59.77.9,255.255.252.0'],
  ['EXTRA', '185.59.78.10,255.255.252.0'],
  ['EXTRA', '185.59.77.21,255.255.252.0'],
  ['EXTRA', '185.59.76.47,255.255.252.0'],
  ['EXTRA', '185.59.78.27,255.255.252.0'],
  ['EXTRA', '185.59.79.23,255.255.252.0'],
  ['EXTRA', '185.59.77.14,255.255.252.0'],
  ['EXTRA', '185.59.79.6,255.255.252.0'],
  ['EXTRA', '185.59.78.15,255.255.252.0'],
  ['EXTRA', '185.59.77.45,255.255.252.0'],
  ['EXTRA', '185.59.77.38,255.255.252.0'],
  ['EXTRA', '185.59.77.33,255.255.252.0'],
  ['EXTRA', '185.59.77.19,255.255.252.0'],
];

var MASKS = {
  '255.255.255.252': 30,
  '255.255.255.248': 29,
  '255.255.255.240': 28,
  '255.255.255.224': 27,
  '255.255.255.192': 26,
  '255.255.255.128': 25,
  '255.255.255.0'  : 24,
  '255.255.254.0'  : 23,
  '255.255.252.0'  : 22,
  '255.255.248.0'  : 21,
  '255.255.240.0'  : 20,
  '255.255.224.0'  : 19,
  '255.255.192.0'  : 18,
  '255.255.128.0'  : 17,
  '255.255.0.0'    : 16,
};

var servers = {
  '1' :    '130c',
  '2' :    '131c',
  '3' :    '132c',
  '4' :    '133c',
  '5' :    '134c',
  '6' :    '135c',
  '7' :    '136c',
  '8' :    '137c',
  '9' :    '138c',
  '10':    '139c',
  '11':    '140c',
  '12':    '141c',
  '13':    '142c',
  '14':    '143c',
  '15':    '144c',
  '16':    '145c',
  'EXTRA': '145c',
};

var assign = function(ips){
  return ips.map(function(ip){
    var serverCode = servers[ip[0]]
    var split = ip[1].split(",");
    var submask = MASKS[split[1]];
    var inet = [split[0],submask].join("/");
    return `SELECT id FROM assign((select id from servers where code = '${serverCode}'),'${inet}');`;
  }).join(' ');
};

exports.up = function(db, callback) {
  db.runSql(assign(DATA),callback);
};

exports.down = function(db, callback) {
  callback();
};
